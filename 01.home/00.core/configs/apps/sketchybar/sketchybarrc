#!/bin/bash
# shellcheck disable=SC1091  # External config files
# Title         : sketchybarrc
# Author        : Bardia Samiee
# Project       : Parametric Forge
# License       : MIT
# Path          : /01.home/00.core/configs/apps/sketchybar/sketchybarrc
# ----------------------------------------------------------------------------
# Clean SketchyBar configuration with Dracula theme

set -euo pipefail

source "$HOME/.config/sketchybar/colors.sh"
source "$HOME/.config/sketchybar/icons.sh"
source "$HOME/.config/sketchybar/constants.sh"

ITEM_DIR="$HOME/.config/sketchybar/items"
PLUGIN_DIR="$HOME/.config/sketchybar/plugins"

# --- Bar Configuration ------------------------------------------------------
bar=(
    height="$HEIGHT_BAR"
    color="$PRIMARY_BLACK"
    border_color="$PRIMARY_WHITE"
    border_width="$BORDER_THIN"
    shadow=on
    shadow.color="$SHADOW_HEAVY"
    shadow.angle="$SHADOW_ANGLE"
    shadow.distance="$SHADOW_DISTANCE"
    position=top
    sticky=on
    padding_right="$PADDINGS_XXLARGE"
    padding_left="$PADDINGS"
    corner_radius="$RADIUS_LARGE"
    y_offset="$OFFSET_BAR"
    margin="$OFFSET_BAR"
    blur_radius="$BLUR_RADIUS_STANDARD"
    notch_width="$PADDINGS_NONE"
    notch_offset="$PADDINGS_NONE"
    font_smoothing=on
)

sketchybar --bar "${bar[@]}"

# --- Default Properties -----------------------------------------------------
defaults=(
    updates=when_shown
    icon.font="$SYMBOL_FONT:$MEDIUM_WEIGHT:$SIZE_MEDIUM"
    icon.color="$WHITE"
    icon.padding_left="$PADDINGS"
    icon.padding_right="$PADDINGS"
    label.font="$TEXT_FONT:$REGULAR_WEIGHT:$SIZE_SMALL"
    label.color="$WHITE"
    label.padding_left="$PADDINGS"
    label.padding_right="$PADDINGS"
    padding_right="$PADDINGS"
    padding_left="$PADDINGS"
    background.height="$HEIGHT_ITEM"
    background.corner_radius="$RADIUS_LARGE"
    popup.background.border_width="$PADDINGS_NONE"
    popup.background.corner_radius="$RADIUS_MEDIUM"
    popup.background.border_color="$TRANSPARENT"
    popup.background.color="$PRIMARY_BLACK"
    popup.blur_radius="$PADDINGS_NONE"
    popup.background.shadow.drawing=on
)

sketchybar --default "${defaults[@]}"

# --- Streamlined Events -----------------------------------------------------
sketchybar --add event space_change \
    --add event windows_on_spaces

# --- Dynamic Spaces ---------------------------------------------------------
source "$ITEM_DIR/spaces.sh"

# --- Logo & Menu Discovery ---------------------------------------------------
source "$ITEM_DIR/logo.sh"
source "$ITEM_DIR/menu-items.sh"

# --- Left Items -------------------------------------------------------------
# Add yabai indicator (positioning handled dynamically in spaces.sh)
sketchybar --add item yabai left \
    --set yabai script="$PLUGIN_DIR/yabai.sh" \
    label.drawing=off \
    icon.width="$ICON_WIDTH_STANDARD" \
    icon="$YABAI_GRID" \
    icon.color="$ORANGE" \
    associated_display=active \
    --subscribe yabai window_focus \
    windows_on_spaces \
    mouse.clicked \
    mouse.entered \
    mouse.exited \
    space_change

# --- Enhanced Front App -----------------------------------------------------
source "$ITEM_DIR/front_app.sh"

# --- Center Items -----------------------------------------------------------
source "$ITEM_DIR/music.sh"

# --- Right Items ------------------------------------------------------------
source "$ITEM_DIR/system-monitor.sh"
source "$ITEM_DIR/volume.sh"
source "$ITEM_DIR/wifi.sh"
source "$ITEM_DIR/mic.sh"
source "$ITEM_DIR/notifications.sh"
source "$ITEM_DIR/packages.sh"
source "$ITEM_DIR/controls.sh"
source "$ITEM_DIR/more-menu.sh"
source "$ITEM_DIR/calendar.sh"

# --- Initialize -------------------------------------------------------------
sketchybar --update
