#!/bin/bash
# shellcheck disable=SC1091  # External config files
# Title         : sketchybarrc
# Author        : Bardia Samiee
# Project       : Parametric Forge
# License       : MIT
# Path          : /01.home/00.core/configs/apps/sketchybar/sketchybarrc
# ----------------------------------------------------------------------------
# Clean SketchyBar configuration with Dracula theme

set -euo pipefail

PLUGIN_DIR="$HOME/.config/sketchybar/plugins"
ITEM_DIR="$HOME/.config/sketchybar/items"
source "$HOME/.config/sketchybar/colors.sh"
source "$HOME/.config/sketchybar/icons.sh"

# --- Bar Configuration ---------------------------------------------------
sketchybar --bar height=36 \
                 position=top \
                 sticky=true \
                 margin=4 \
                 y_offset=4 \
                 corner_radius=16 \
                 padding_left=12 \
                 padding_right=12 \
                 color="$BAR_COLOR" \
                 blur_radius=16

# --- Default Properties --------------------------------------------------
sketchybar --default updates=when_shown \
                     icon.font="GeistMono Nerd Font:Light:15.0" \
                     icon.color="$ICON_COLOR" \
                     icon.padding_left=4 \
                     icon.padding_right=4 \
                     label.font="GeistMono Nerd Font:Light:15.0" \
                     label.color="$LABEL_COLOR" \
                     label.padding_left=4 \
                     label.padding_right=4 \
                     background.corner_radius=8 \
                     background.height=28 \
                     padding_left=4 \
                     padding_right=4

# --- Core Events ---------------------------------------------------------
sketchybar --add event space_change \
           --add event window_focus \
           --add event windows_on_spaces

# --- Dynamic Spaces ------------------------------------------------------
source "$ITEM_DIR/spaces.sh"

# --- Left Items ----------------------------------------------------------
sketchybar --add item apple_menu left \
           --set apple_menu icon="$APPLE" \
                           label.drawing=off \
                           background.drawing=off \
                           click_script="open -a 'System Settings'"

sketchybar --add item yabai left \
           --set yabai script="$PLUGIN_DIR/yabai.sh" \
                       icon.font="GeistMono Nerd Font:Bold:16.0" \
                       label.drawing=off \
                       icon.width=30 \
                       icon="$YABAI_GRID" \
                       icon.color="$ORANGE" \
                       associated_display=active \
           --subscribe yabai window_focus \
                            windows_on_spaces \
                            mouse.clicked \
                            space_change \
                            \
           --add item front_app left \
           --set front_app icon.drawing=off \
                           label.color="$LABEL_COLOR" \
                           background.drawing=off \
                           script='yabai -m query --windows --window | jq -r ".app" 2>/dev/null || echo "Desktop"' \
           --subscribe front_app front_app_switched window_focus

# --- Initialize ----------------------------------------------------------
sketchybar --update